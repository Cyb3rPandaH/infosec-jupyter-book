

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>DCSync dcerpc dcerpc &#8212; Infosec Jupyter Book</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../../../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/sphinx-book-theme.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <script src="../../../_static/togglebutton.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/mystnb.js"></script>
    <script src="../../../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .secondtoggle, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script async="async" src="../../../_static/thebelab.js"></script>
    <link rel="canonical" href="https://infosecjupyterbook.com/community-workshops/defcon_btv_2020/use-cases/02_Data_Analysis_DCSync_dcerpc.html" />
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Remote Create Instance - dcerpc - wmi" href="03_Data_Analysis_RemoteCreateInstance_dcerpc_wmi.html" />
    <link rel="prev" title="Process Injection - CreatRemoteThread" href="01_Data_Analysis_Process_Injection.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">
<!-- Put requirejs at the end so it's always after bootstrap -->
<!-- TODO: remove this once https://github.com/pandas-dev/pydata-sphinx-theme/pull/149 is merged -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script>


<!-- Opengraph tags -->
<meta property="og:url"         content="https://infosecjupyterbook.com/community-workshops/defcon_btv_2020/use-cases/02_Data_Analysis_DCSync_dcerpc.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="DCSync dcerpc dcerpc" />
<meta property="og:description" content="DCSync dcerpc dcerpc  Author: Jose Rodriguez (@Cyb3rPandah)  Project: Infosec Jupyter Book  Public Organization: Open Threat Research  License: Creative Commons" />
<meta property="og:image"       content="https://infosecjupyterbook.com/_static/logo.png" />

<meta name="twitter:card" content="summary">


  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          

<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../../index.html">
  
  <img src="../../../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Infosec Jupyter Book</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  
  <ul class="nav sidenav_l1">
<li class="navbar-special">
<p class="margin-caption">Getting Started</p>
</li>
  <li class="">
    <a href="../../../getting-started/what_is_jupyter.html">What Is Jupyter?</a>
  </li>
  <li class="">
    <a href="../../../getting-started/architecture.html">Architecture</a>
  </li>
  <li class="">
    <a href="../../../getting-started/installation.html">Installation</a>
  </li>
<li class="navbar-special">
<p class="margin-caption">Fundamentals</p>
</li>
  <li class="">
    <a href="../../../fundamentals/programming/intro.html">Programming Languages</a>
  </li>
  <li class="">
    <a href="../../../fundamentals/libraries/intro.html">Libraries</a>
  </li>
<li class="navbar-special">
<p class="margin-caption">Use Cases</p>
</li>
  <li class="">
    <a href="../../../use-cases/data-analysis/intro.html">Data Analysis</a>
  </li>
  <li class="">
    <a href="../../../use-cases/data-connectors/intro.html">Data Connectors</a>
  </li>
  <li class="">
    <a href="../../../use-cases/data-visualizations/intro.html">Data Visualizations</a>
  </li>
<li class="navbar-special">
<p class="margin-caption">Community Projects</p>
</li>
  <li class="">
    <a href="../../../community-projects/threat-hunter-playbook.html">Threat Hunter Playbook</a>
  </li>
<li class="navbar-special">
<p class="margin-caption">Community Workshops</p>
</li>
  <li class="active">
    <a href="../intro.html">Defcon BTV 2020</a>
  <ul class="nav sidenav_l2">
    <li class="">
      <a href="../basic-concepts/intro.html">Basic Data Analysis Concepts</a>
    </li>
    <li class="active">
      <a href="intro.html">Use Cases</a>
      <ul class="nav sidenav_l3">
      <li class="">
        <a href="01_Data_Analysis_Process_Injection.html">Process Injection - CreatRemoteThread</a>
      </li>
      <li class="active">
        <a href="">DCSync dcerpc dcerpc</a>
      </li>
      <li class="">
        <a href="03_Data_Analysis_RemoteCreateInstance_dcerpc_wmi.html">Remote Create Instance - dcerpc - wmi</a>
      </li>
    </ul>
    </li>
  </ul>
  </li>
<li class="navbar-special">
<p class="margin-caption">Community Events</p>
</li>
  <li class="">
    <a href="../../../community-events/jupyterthon.html">Infosec Jupyterthon</a>
  </li>
</ul>
</nav>
<p class="navbar_footer">Powered by <a href="https://jupyterbook.org">Jupyter Book</a></p>
</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse" data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu" aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation" title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        <div class="dropdown-buttons-trigger">
            <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i class="fas fa-download"></i></button>

            
            <div class="dropdown-buttons">
                <!-- ipynb file if we had a myst markdown file -->
                
                <!-- Download raw file -->
                <a class="dropdown-buttons" href="../../../_sources/community-workshops/defcon_btv_2020/use-cases/02_Data_Analysis_DCSync_dcerpc.ipynb.txt"><button type="button" class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip" data-placement="left">.ipynb</button></a>
                <!-- Download PDF via print -->
                <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF" onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
            </div>
            
        </div>

        <!-- Edit this page -->
        <a class="edit-button" href="https://github.com/OTRF/infosec-jupyter-book/edit/master/docs/community-workshops/defcon_btv_2020/use-cases/02_Data_Analysis_DCSync_dcerpc.ipynb"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="bottom" title="Edit this page"><i class="fas fa-pencil-alt"></i></button></a>

        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->
        
        <div class="dropdown-buttons-trigger">
            <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
            <div class="dropdown-buttons">
                
                <a class="binder-button" href="https://mybinder.org/v2/gh/OTRF/infosec-jupyter-book/master?urlpath=tree/docs/community-workshops/defcon_btv_2020/use-cases/02_Data_Analysis_DCSync_dcerpc.ipynb"><button type="button" class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip" data-placement="left"><img class="binder-button-logo" src="../../../_static/images/logo_binder.svg" alt="Interact on binder">Binder</button></a>
                
                
                <button type="button" class="btn btn-secondary topbarbtn thebelab-launch-button" onclick="initThebelab()" title="Launch Thebelab" data-toggle="tooltip" data-placement="left"><i class="fas fa-rocket"></i><span style="margin-left: .4em;">ThebeLab</span></button>
                
            </div>
        </div>
        

        
    </div>
    <div class="d-none d-md-block col-md-2 bd-toc show">
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#creating-sql-view-from-mordor-process-injection-dataset" class="nav-link">Creating SQL view from Mordor Process Injection dataset</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#create-spark-session" class="nav-link">Create Spark session</a>
        </li>
    
        <li class="nav-item toc-entry toc-h3">
            <a href="#expose-the-dataframe-as-a-sql-view" class="nav-link">Expose the dataframe as a SQL view</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#technical-description" class="nav-link">Technical Description</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#filtering-summarizing-data" class="nav-link">Filtering & Summarizing data</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#get-most-frequent-access-flags-bitmask-of-processes-accessing-other-processes" class="nav-link">Get most frequent Access Flags (Bitmask) of Processes accessing other Processes</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#correlating-data" class="nav-link">Correlating data</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#find-source-processes-that-used-createremotethread-apis" class="nav-link">Find Source Processes that used CreateRemoteThread APIs</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#thank-you-i-hope-you-enjoyed-it" class="nav-link">Thank you! I hope you enjoyed it!</a>
        </li>
    
    </ul>
</nav>



<div class="tocsection editthispage">
    <a href="https://github.com/OTRF/infosec-jupyter-book/edit/master/docs/community-workshops/defcon_btv_2020/use-cases/02_Data_Analysis_DCSync_dcerpc.ipynb">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 col-xxl-7 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="dcsync-dcerpc-dcerpc">
<h1>DCSync dcerpc dcerpc<a class="headerlink" href="#dcsync-dcerpc-dcerpc" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><strong>Author</strong>: Jose Rodriguez (&#64;Cyb3rPandah)</p></li>
<li><p><strong>Project</strong>: Infosec Jupyter Book</p></li>
<li><p><strong>Public Organization</strong>: <a class="reference external" href="https://github.com/OTRF">Open Threat Research</a></p></li>
<li><p><strong>License</strong>: <a class="reference external" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International</a></p></li>
<li><p><strong>Reference</strong>:</p>
<ul>
<li><p>https://spark.apache.org/docs/latest/api/python/pyspark.sql.html</p></li>
<li><p>https://threathunterplaybook.com/notebooks/windows/06_credential_access/WIN-180815210510.html</p></li>
</ul>
</li>
</ul>
<div class="section" id="creating-sql-view-from-mordor-process-injection-dataset">
<h2>Creating SQL view from Mordor Process Injection dataset<a class="headerlink" href="#creating-sql-view-from-mordor-process-injection-dataset" title="Permalink to this headline">¶</a></h2>
<div class="section" id="create-spark-session">
<h3>Create Spark session<a class="headerlink" href="#create-spark-session" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span> \
    <span class="o">.</span><span class="n">builder</span> \
    <span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&quot;Spark_Data_Analysis&quot;</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="s2">&quot;spark.sql.caseSensitive&quot;</span><span class="p">,</span><span class="s2">&quot;True&quot;</span><span class="p">)</span> \
    <span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="expose-the-dataframe-as-a-sql-view">
<h3>Expose the dataframe as a SQL view<a class="headerlink" href="#expose-the-dataframe-as-a-sql-view" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dcSyncJson</span> <span class="o">=</span> <span class="s1">&#39;../datasets/covenant_dcsync_dcerpc_drsuapi_DsGetNCChanges_2020-08-05020926.json&#39;</span>

<span class="n">dcSyncDf</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="n">dcSyncJson</span><span class="p">)</span>

<span class="n">dcSyncDf</span><span class="o">.</span><span class="n">createOrReplaceTempView</span><span class="p">(</span><span class="s1">&#39;dcSync&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="technical-description">
<h2>Technical Description<a class="headerlink" href="#technical-description" title="Permalink to this headline">¶</a></h2>
<p>Active Directory replication is the process by which the changes that originate on one domain controller are automatically transferred to other domain controllers that store the same data.
Active Directory data takes the form of objects that have properties, or attributes. Each object is an instance of an object class, and object classes and their respective attributes are defined in the Active Directory schema.
The values of the attributes define the object, and a change to a value of an attribute must be transferred from the domain controller on which it occurs to every other domain controller that stores a replica of that object.
An adversary can abuse this model and request information about a specific account via the replication request.
This is done from an account with sufficient permissions (usually domain admin level) to perform that request.
Usually the accounts performing replication operations in a domain are computer accounts (i.e dcaccount$).
Therefore, it might be abnormal to see other non-dc-accounts doing it.</p>
<p>The following access rights / permissions are needed for the replication request according to the domain functional level</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>Control access right symbol</p></th>
<th class="text-align:left head"><p>Identifying GUID used in ACE</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>DS-Replication-Get-Changes</p></td>
<td class="text-align:left"><p>1131f6aa-9c07-11d1-f79f-00c04fc2dcd2</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>DS-Replication-Get-Changes-All</p></td>
<td class="text-align:left"><p>1131f6ad-9c07-11d1-f79f-00c04fc2dcd2</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>DS-Replication-Get-Changes-In-Filtered-Set</p></td>
<td class="text-align:left"><p>89e95b76-444d-4c62-991a-0facbeda640c</p></td>
</tr>
</tbody>
</table>
<p>Additional reading</p>
<ul class="simple">
<li><p>https://github.com/hunters-forge/ThreatHunter-Playbook/tree/master/docs/library/active_directory_replication.md</p></li>
</ul>
</div>
<div class="section" id="filtering-summarizing-data">
<h2>Filtering &amp; Summarizing data<a class="headerlink" href="#filtering-summarizing-data" title="Permalink to this headline">¶</a></h2>
<div class="section" id="get-most-frequent-access-flags-bitmask-of-processes-accessing-other-processes">
<h3>Get most frequent Access Flags (Bitmask) of Processes accessing other Processes<a class="headerlink" href="#get-most-frequent-access-flags-bitmask-of-processes-accessing-other-processes" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">operationObject</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">SELECT `@timestamp`, Hostname, SubjectUserName, SubjectLogonId</span>
<span class="sd">FROM dcSync</span>
<span class="sd">WHERE Channel = &quot;Security&quot;</span>
<span class="sd">    AND EventID = 4662</span>
<span class="sd">    AND AccessMask = &quot;0x100&quot;</span>
<span class="sd">    AND (</span>
<span class="sd">        Properties LIKE &quot;%1131f6aa_9c07_11d1_f79f_00c04fc2dcd2%&quot;</span>
<span class="sd">        OR Properties LIKE &quot;%1131f6ad_9c07_11d1_f79f_00c04fc2dcd2%&quot;</span>
<span class="sd">        OR Properties LIKE &quot;%89e95b76_444d_4c62_991a_0facbeda640c%&quot;</span>
<span class="sd">    )</span>
<span class="sd">    AND NOT SubjectUserName LIKE &quot;%$&quot;</span>
<span class="sd">&#39;&#39;&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This dataframe has </span><span class="si">{}</span><span class="s1"> records!!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">operationObject</span><span class="o">.</span><span class="n">count</span><span class="p">()))</span>
<span class="n">operationObject</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>This dataframe has 3 records!!
+------------------------+-----------------------+---------------+--------------+
|@timestamp              |Hostname               |SubjectUserName|SubjectLogonId|
+------------------------+-----------------------+---------------+--------------+
|2020-08-05T06:10:03.798Z|MORDORDC.theshire.local|pgustavo       |0x824909      |
|2020-08-05T06:10:03.799Z|MORDORDC.theshire.local|pgustavo       |0x824909      |
|2020-08-05T06:10:03.799Z|MORDORDC.theshire.local|pgustavo       |0x824909      |
+------------------------+-----------------------+---------------+--------------+

</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="correlating-data">
<h2>Correlating data<a class="headerlink" href="#correlating-data" title="Permalink to this headline">¶</a></h2>
<div class="section" id="find-source-processes-that-used-createremotethread-apis">
<h3>Find Source Processes that used CreateRemoteThread APIs<a class="headerlink" href="#find-source-processes-that-used-createremotethread-apis" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">authentication</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">SELECT o.`@timestamp`, o.Hostname, o.SubjectUserName, o.SubjectLogonId, a.IpAddress</span>
<span class="sd">FROM dcSync o</span>
<span class="sd">INNER JOIN (</span>
<span class="sd">    SELECT Hostname,TargetUserName,TargetLogonId,IpAddress</span>
<span class="sd">    FROM dcSync</span>
<span class="sd">    WHERE lower(Channel) = &quot;security&quot;</span>
<span class="sd">        AND EventID = 4624</span>
<span class="sd">        AND LogonType = 3</span>
<span class="sd">        AND IpAddress IS NOT NULL</span>
<span class="sd">        AND NOT TargetUserName LIKE &quot;%$&quot;</span>
<span class="sd">    ) a</span>
<span class="sd">ON o.SubjectLogonId = a.TargetLogonId</span>
<span class="sd">WHERE lower(o.Channel) = &quot;security&quot;</span>
<span class="sd">    AND o.EventID = 4662</span>
<span class="sd">    AND o.AccessMask = &quot;0x100&quot;</span>
<span class="sd">    AND (</span>
<span class="sd">        o.Properties LIKE &quot;%1131f6aa_9c07_11d1_f79f_00c04fc2dcd2%&quot;</span>
<span class="sd">        OR o.Properties LIKE &quot;%1131f6ad_9c07_11d1_f79f_00c04fc2dcd2%&quot;</span>
<span class="sd">        OR o.Properties LIKE &quot;%89e95b76_444d_4c62_991a_0facbeda640c%&quot;</span>
<span class="sd">    )</span>
<span class="sd">    AND o.Hostname = a.Hostname</span>
<span class="sd">    AND NOT o.SubjectUserName LIKE &quot;%$&quot;</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This dataframe has </span><span class="si">{}</span><span class="s1"> records!!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">authentication</span><span class="o">.</span><span class="n">count</span><span class="p">()))</span>
<span class="n">authentication</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-none notranslate"><div class="highlight"><pre><span></span>This dataframe has 3 records!!
+------------------------+-----------------------+---------------+--------------+-----------+
|@timestamp              |Hostname               |SubjectUserName|SubjectLogonId|IpAddress  |
+------------------------+-----------------------+---------------+--------------+-----------+
|2020-08-05T06:10:03.798Z|MORDORDC.theshire.local|pgustavo       |0x824909      |172.18.39.5|
|2020-08-05T06:10:03.799Z|MORDORDC.theshire.local|pgustavo       |0x824909      |172.18.39.5|
|2020-08-05T06:10:03.799Z|MORDORDC.theshire.local|pgustavo       |0x824909      |172.18.39.5|
+------------------------+-----------------------+---------------+--------------+-----------+

</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="thank-you-i-hope-you-enjoyed-it">
<h2>Thank you! I hope you enjoyed it!<a class="headerlink" href="#thank-you-i-hope-you-enjoyed-it" title="Permalink to this headline">¶</a></h2>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "OTRF/infosec-jupyter-book",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "community-workshops/defcon_btv_2020/use-cases"
        }
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="01_Data_Analysis_Process_Injection.html" title="previous page">Process Injection - CreatRemoteThread</a>
    <a class='right-next' id="next-link" href="03_Data_Analysis_RemoteCreateInstance_dcerpc_wmi.html" title="next page">Remote Create Instance - dcerpc - wmi</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2020.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.4.1.<br/>
    </p>
  </div>
</footer>
</main>


      </div>
    </div>

    <script src="../../../_static/js/index.js"></script>
    
  </body>
</html>